- Setup Invoice Wizard 
- !record {model: l10n_ar_invoice.installer, id: invoice_resin_config_1}:
    company_id: com_ivari
    responsability_id: res_IVARI
    do_export: False
    remove_old_journals: True
    purchase_by_class: False

- Fill the Invoice Wizard
- !python {model: l10n_ar_invoice.installer}: |
    self.view_init(cr, uid, [ref("invoice_resin_config_1")], {})
    data = self.read(cr, uid, ref("invoice_resin_config_1"), ['company_id', 'responsability_id', 'do_export', 'remove_old_journals', 'sequence_by', 'point_of_sale', 'purchase_by_class'])
    del data['id']
    data['update_posted']=True
    res = self.update_journals(cr, uid, None, **data)
    k = { 'journals_to_delete': [(5,)]+[ (0, 0, v) for v in res['value']['journals_to_delete'] ],
          'sequences_to_create': [(5,)]+[ (0, 0, v) for v in res['value']['sequences_to_create'] ],
          'journals_to_create': [(5,)]+[ (0, 0, v) for v in res['value']['journals_to_create'] ] }
    self.write(cr, uid, [ref("invoice_resin_config_1")], k)

- Check if all new items are ok
- !python {model: l10n_ar_invoice.new_journal}: |
    ids = self.search(cr, uid, [('builder_id','=',ref('invoice_resin_config_1'))])
    test = set([ i.name for i in self.browse(cr, uid, ids) ])
    expected = set([
        u'Factura [Compra] (0001-FCX)',
        u'Nota de D\xe9bito [Compra] (0001-DCX)',
        u'Nota de Cr\xe9dito [Compra] (0001-CCX)',

        u'Factura [Venta B] (0001-FVB)',
        u'Nota de D\xe9bito [Venta B] (0001-DVB)',
        u'Nota de Cr\xe9dito [Venta B] (0001-CVB)',

        u'Factura [Venta M] (0001-FVM)',
        u'Nota de D\xe9bito [Venta M] (0001-DVM)',
        u'Nota de Cr\xe9dito [Venta M] (0001-CVM)',

        u'Factura [Venta A] (0001-FVA)',
        u'Nota de D\xe9bito [Venta A] (0001-DVA)',
        u'Nota de Cr\xe9dito [Venta A] (0001-CVA)',
        ])

    if test != expected:
        print "Test: ", test
        print "Expected: ", expected
        print "Test - Expected: ", test.difference(expected)
        print "Expected - Test: ", expected.difference(test)
        raise Exception, 'New journals are not equal to expected.'

- Delete Journals, Create Sequences and Journals 
- !python {model: l10n_ar_invoice.installer}: |
    self.delete_journals(cr, uid, [ref("invoice_resin_config_1")], {})
    self.create_sequences(cr, uid, [ref("invoice_resin_config_1")], {})
    self.create_journals(cr, uid, [ref("invoice_resin_config_1")], {})

- Check if sequences are ok
- !python {model: ir.sequence}: |
    ids = self.search(cr, uid, [])
    test = set([ i.name for i in self.browse(cr, uid, ids) ])
    expected = set([
                u'Sales Credit Note Journal',
                u'Bank Journal',
                u'Account Refund Out',
                u'Cash Journal',
                u'Account reconcile sequence',
                u'Account Cash Statement',
                u'Account Bank Statement',
                u'Expenses Credit Notes Journal',
                u'Account Invoice In',
                u'Checks Journal',
                u'Purchase Journal',
                u'Analytic account sequence',
                u'Account Invoice Out',
                u'Account Refund In',
                u'Sale Journal',
                u'Account Journal',
                u'Document type purchase (0001)',
                u'Document type sale (0001)',
                        ])
    if test != expected:
        print "Test: ", test
        print "Expected: ", expected
        print "Test - Expected: ", test.difference(expected)
        print "Expected - Test: ", expected.difference(test)
        raise Exception, 'New sequences are not equal to expected.'

- Check if journals are ok
- !python {model: account.journal}: |
    ids = self.search(cr, uid, [])
    test = set([ i.name for i in self.browse(cr, uid, ids) ])
    expected = set([
        u'Checks Journal - (test)',
        u'Bank Journal - (test)',
        u'Cash Journal - (test)',

        u'Factura [Compra] (0001-FCX)',
        u'Nota de D\xe9bito [Compra] (0001-DCX)',
        u'Nota de Cr\xe9dito [Compra] (0001-CCX)',

        u'Factura [Venta B] (0001-FVB)',
        u'Nota de D\xe9bito [Venta B] (0001-DVB)',
        u'Nota de Cr\xe9dito [Venta B] (0001-CVB)',

        u'Factura [Venta M] (0001-FVM)',
        u'Nota de D\xe9bito [Venta M] (0001-DVM)',
        u'Nota de Cr\xe9dito [Venta M] (0001-CVM)',

        u'Factura [Venta A] (0001-FVA)',
        u'Nota de D\xe9bito [Venta A] (0001-DVA)',
        u'Nota de Cr\xe9dito [Venta A] (0001-CVA)',

        ])
    if test != expected:
        print "Test: ", test
        print "Expected: ", expected
        print "Test - Expected: ", test.difference(expected)
        print "Expected - Test: ", expected.difference(test)
        raise Exception, 'New journals are not equal to expected.'

